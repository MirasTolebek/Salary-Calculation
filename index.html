<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–†–∞—Å—á–µ—Ç –ë–†–£–¢–¢–û-–ó–ü –ø–æ –°—Ö–µ–º–µ –°–º–µ–Ω</title>
    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ Tailwind CSS –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Dark Mode -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            // –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º Dark Mode –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ (Telegram –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏—Ö)
            darkMode: 'media', 
            theme: {
                extend: {
                    colors: {
                        // –¢–µ–ª–µ–≥—Ä–∞–º-–ø–æ—Ö–æ–∂–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–≥–æ –¥–∏–∑–∞–π–Ω–∞
                        tg_bg_light: '#F3F4F6', // –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–ø–æ—á—Ç–∏ –±–µ–ª—ã–π)
                        tg_bg_dark: '#182025',  // –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (—Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π/—Å–µ—Ä—ã–π)
                        tg_card_light: '#FFFFFF', // –°–≤–µ—Ç–ª—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫
                        tg_card_dark: '#212D3A', // –¢–µ–º–Ω—ã–π —Ñ–æ–Ω –∫–∞—Ä—Ç–æ—á–µ–∫
                        tg_accent: '#2563EB',   // –û—Å–Ω–æ–≤–Ω–æ–π –∞–∫—Ü–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π (blue-600)
                        tg_dark_accent: '#3B82F6', // –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Å–∏–Ω–∏–π –≤ —Ç–µ–º–Ω–æ–π —Ç–µ–º–µ (blue-500)
                    }
                }
            }
        }
    </script>
    <style>
        /* –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–∞ Inter –∏ –æ–±—â–∏—Ö —Å—Ç–∏–ª–µ–π */
        @import url('https://fonts.com/css2?family=Inter:wght@400;500;600;700;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            padding: 12px; 
            /* –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–æ–Ω –∑–∞–¥–∞–Ω —á–µ—Ä–µ–∑ Tailwind, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å Dark Mode */
        }
        .app-container {
            max-width: 480px; 
        }
        .card {
            /* –°–∫—Ä—É–≥–ª–µ–Ω–∏—è –∏ —Ç–µ–Ω–∏ –≤ —Å—Ç–∏–ª–µ Telegram */
            border-radius: 16px; 
            padding: 24px; 
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        /* –°—Ç–∏–ª—å –¥–ª—è –∏–Ω–ø—É—Ç–æ–≤: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã –∏ —Ñ–æ–Ω */
        input[type="number"], select {
            border-width: 1px;
            transition: all 0.2s;
            border-radius: 12px; 
        }
        
        /* Light Mode Input/Select styles */
        input[type="number"], select {
            border-color: #E5E7EB;
            background-color: #FFFFFF;
            color: #1F2937;
        }
        input[type="number"]:focus, select:focus {
            border-color: #4f46e5; 
            box-shadow: 0 0 0 2px #c7d2fe;
            outline: none;
        }

        /* Dark Mode Input/Select styles */
        .dark input[type="number"], .dark select {
            border-color: #4B5563; /* gray-600 */
            background-color: #1F2937; /* dark input bg */
            color: #E5E7EB;
        }
        .dark input[type="number"]:focus, .dark select:focus {
            border-color: #3B82F6; 
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.5); 
        }

        /* –ê–∫—Ü–µ–Ω—Ç–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ */
        .header-accent {
            color: #2563EB; /* tg_accent */
        }
        .dark .header-accent {
            color: #3B82F6; /* tg_dark_accent */
        }

        /* –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –î–Ω–∏: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        .calendar-day {
            padding: 8px 0;
            text-align: center;
            border-radius: 8px; 
            cursor: pointer;
            transition: background-color 0.1s;
            position: relative;
            font-weight: 500;
        }
        .calendar-day:not(.day-empty):hover {
            background-color: #f0f0f0;
        }
        .dark .calendar-day:not(.day-empty):hover {
            background-color: #374151; /* Dark hover */
        }
        .day-selected {
            border: 2px solid #2563EB; 
            color: #1f2937 !important;
            background-color: #EFF6FF !important; /* blue-50 */
        }
        .dark .day-selected {
            border-color: #3B82F6; 
            color: #E5E7EB !important;
            background-color: #1E3A8A !important; /* blue-900 */
        }
        
        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –¶–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞ –¥–ª—è —Å–º–µ–Ω (Light/Dark) */
        /* –î–Ω–µ–≤–Ω–∞—è - –ó–µ–ª–µ–Ω—ã–π */
        .shift-0 { background-color: #e5faed; color: #16a34a; } 
        .dark .shift-0 { background-color: #103C26; color: #6EE7B7; } 
        /* –ù–æ—á–Ω–∞—è - –°–∏–Ω–∏–π */
        .shift-1 { background-color: #e0f2fe; color: #2563eb; } 
        .dark .shift-1 { background-color: #14356E; color: #60A5FA; } 
        /* –û—Ç—Å—ã–ø–Ω–æ–π - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π */
        .shift-2 { background-color: #f3e8ff; color: #7c3aed; } 
        .dark .shift-2 { background-color: #3A236F; color: #C4B5FD; }
        /* –í—ã—Ö–æ–¥–Ω–æ–π - –°–µ—Ä—ã–π */
        .shift-3 { background-color: #f1f5f9; color: #64748b; } 
        .dark .shift-3 { background-color: #374151; color: #9CA3AF; } 
        
        /* –û—Å—Ç–∞–ª—å–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü –∏ –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã */
        .calc-table td:nth-child(1) { padding-right: 8px; }
        .calc-table td:nth-child(2) { text-align: right; font-weight: 600; white-space: nowrap; }
        #hourlyGrossSalaryResult { font-size: 2.25rem; line-height: 2.5rem; }
        .schedule-table-date { width: 80px; white-space: nowrap; }
        .schedule-table-shift { width: auto; }

    </style>
</head>
<body class="bg-tg_bg_light dark:bg-tg_dark_bg transition-colors duration-300">

<div class="app-container p-4 flex flex-col gap-6 w-full mx-auto min-h-screen relative">
    <h1 class="text-3xl font-extrabold text-gray-900 dark:text-gray-100 text-center mt-4 mb-2">–ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ë–†–£–¢–¢–û-–ó–ü</h1>
    <p class="text-center text-sm text-gray-500 dark:text-gray-400 -mt-2">–†–∞—Å—á–µ—Ç –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π –ø–æ —Å–º–µ–Ω–Ω–æ–º—É –≥—Ä–∞—Ñ–∏–∫—É</p>

    <!-- 1. –°—Ç–∞–≤–∫–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã -->
    <div class="card bg-tg_card_light dark:bg-tg_card_dark transition-colors duration-300 shadow-md dark:shadow-none dark:border dark:border-gray-700">
        <h2 class="text-xl font-bold mb-5 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">1. –°—Ç–∞–≤–∫–∞ –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã</h2>
        
        <!-- –í–≤–æ–¥ —á–∞—Å–æ–≤ –∑–∞ —Å–º–µ–Ω—É -->
        <div class="mb-4">
            <label for="hoursPerShiftInput" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">–ß–∞—Å–æ–≤ –∑–∞ —Å–º–µ–Ω—É (—Ä–∞–±–æ—á–∏–µ –¥–Ω–∏):</label>
            <div class="flex items-center space-x-2">
                <input 
                    type="number"
                    id="hoursPerShiftInput" 
                    value="11" 
                    placeholder="11"
                    class="w-full p-3"
                    min="1" 
                    oninput="updateHoursAndRecalculate()"
                />
                <span class="text-lg font-medium text-gray-500 dark:text-gray-400 flex-shrink-0">—á–∞—Å–æ–≤</span>
            </div>
        </div>

        <!-- –í–≤–æ–¥ —á–∞—Å–æ–≤–æ–π —Å—Ç–∞–≤–∫–∏ -->
        <div class="mb-6">
            <label for="hourlyRateInput" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">–ß–∞—Å–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ (1.0x):</label>
            <div class="flex items-center space-x-2">
                <input 
                    type="number"
                    id="hourlyRateInput" 
                    value="1720" 
                    placeholder="1720"
                    class="w-full p-3"
                    min="0" 
                    oninput="updateCalculations()"
                />
                <span class="text-lg font-medium text-gray-500 dark:text-gray-400 flex-shrink-0">—Ç–≥/—á–∞—Å</span>
            </div>
        </div>

        <div id="shiftCostSummary" class="mt-4 p-3 bg-indigo-50 dark:bg-gray-800 rounded-xl text-sm space-y-2 border border-indigo-200 dark:border-gray-700">
            <!-- –°—é–¥–∞ –±—É–¥—É—Ç –≤—ã–≤–æ–¥–∏—Ç—å—Å—è —Ä–∞—Å—á–µ—Ç—ã —Å—Ç–∞–≤–æ–∫ -->
            <p id="dayShiftCost" class="font-medium text-gray-700 dark:text-gray-300"></p>
            <p id="nightShiftCost" class="font-medium text-gray-700 dark:text-gray-300"></p>
        </div>
    </div>

    <!-- 2. –ì—Ä–∞—Ñ–∏–∫ –∏ —Å—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞ -->
    <div class="card bg-tg_card_light dark:bg-tg_card_dark transition-colors duration-300 shadow-md dark:shadow-none dark:border dark:border-gray-700">
        <h2 class="text-xl font-bold mb-5 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">2. –ì—Ä–∞—Ñ–∏–∫ –∏ —Å—Ç–∞—Ä—Ç —Ü–∏–∫–ª–∞</h2>
        
        <!-- –í—ã–±–æ—Ä —Å—Ö–µ–º—ã —Å–º–µ–Ω—ã -->
        <div class="mb-4">
            <label for="shiftSchemeSelector" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ö–µ–º—É —Å–º–µ–Ω—ã:</label>
            <select 
                id="shiftSchemeSelector" 
                class="w-full p-3" 
                onchange="applySchemeDefaults(); clearOverrides(); updateCalculations();"
            >
                <option value="2/2_DNOW">2/2 (–î,–ù,–û,–í) - 11—á</option>
                <option value="5/2_D">5/2 (–î,–î,–î,–î,–î,–í,–í) - 8—á</option>
                <option value="2/2_DDVV">2/2 (–î,–î,–í,–í) - 11—á</option>
            </select>
        </div>
        
        <!-- –í—ã–±–æ—Ä –Ω–∞—á–∞–ª—å–Ω–æ–π –¥–∞—Ç—ã —Ü–∏–∫–ª–∞ -->
        <div class="mb-3 relative">
            <label for="startDateDisplay" class="block text-sm font-medium text-gray-600 dark:text-gray-400 mb-2">–î–∞—Ç–∞, —Å –∫–æ—Ç–æ—Ä–æ–π –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Ü–∏–∫–ª:</label>
            <div 
                id="startDateDisplay" 
                class="w-full p-3 border border-gray-200 dark:border-gray-600 rounded-xl cursor-pointer text-lg text-center bg-gray-50 dark:bg-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 transition font-semibold text-gray-700 dark:text-gray-200"
                onclick="toggleCalendar()"
            >
                <!-- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–∞—Ç–∞ –±—É–¥–µ—Ç –∑–¥–µ—Å—å -->
            </div>
            <input type="hidden" id="startDateInput" value="">
            
            <!-- –ö–∞—Å—Ç–æ–º–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å-–º–æ–¥–∞–ª—å -->
            <div id="calendarContainer" class="absolute w-full z-50 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-2xl shadow-2xl mt-2 p-4 hidden">
                <div class="flex justify-between items-center mb-3">
                    <button class="text-tg_accent dark:text-tg_dark_accent p-2 rounded-full hover:bg-indigo-50 dark:hover:bg-gray-700 transition" onclick="changeMonth(-1)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                    </button>
                    <span id="calendarMonthYear" class="font-bold text-gray-700 dark:text-gray-200 text-lg"></span>
                    <button class="text-tg_accent dark:text-tg_dark_accent p-2 rounded-full hover:bg-indigo-50 dark:hover:bg-gray-700 transition" onclick="changeMonth(1)">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                    </button>
                </div>
                <div id="calendarWeekdays" class="calendar-grid text-xs font-medium text-gray-500 dark:text-gray-400 mb-1">
                    <span>–ü–Ω</span><span>–í—Ç</span><span>–°—Ä</span><span>–ß—Ç</span><span>–ü—Ç</span><span>–°–±</span><span>–í—Å</span>
                </div>
                <div id="calendarDays" class="calendar-grid text-sm">
                    <!-- –î–Ω–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
    </div>

    <!-- 3. –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç -->
    <div class="card bg-tg_card_light dark:bg-tg_card_dark transition-colors duration-300 shadow-md dark:shadow-none dark:border dark:border-gray-700">
        <h2 class="text-xl font-bold mb-5 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">3. –°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç –∑–∞ <span id="currentMonthName" class="header-accent">–ú–µ—Å—è—Ü</span></h2>
        
        <!-- –ß–∞—Å—Ç—å –ê: –°–≤–æ–¥–∫–∞ —á–∞—Å–æ–≤ –∏ —Å–º–µ–Ω -->
        <h3 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">–°–≤–æ–¥–∫–∞ –ø–æ —á–∞—Å–∞–º –∏ —Å–º–µ–Ω–∞–º:</h3>
        <div class="space-y-3 text-gray-700 dark:text-gray-300 mb-5 p-3 border border-gray-100 dark:border-gray-600 rounded-xl bg-gray-50 dark:bg-gray-800">
            <!-- –û–±—â–∏–µ —Å–º–µ–Ω—ã -->
            <div class="flex justify-between items-center text-md font-bold">
                <span class="flex-shrink-0">üóìÔ∏è –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–º–µ–Ω:</span>
                <span id="totalShifts" class="text-xl text-gray-800 dark:text-gray-100 font-extrabold flex-shrink-0">0</span>
            </div>
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —Å–º–µ–Ω -->
            <div class="ml-2 space-y-1">
                <p class="flex justify-between items-center text-sm">
                    <span class="pr-2">‚òÄÔ∏è –î–Ω–µ–≤–Ω—ã—Ö —Å–º–µ–Ω (1.0):</span>
                    <span id="dayShiftsCount" class="font-semibold flex-shrink-0 text-green-600 dark:text-green-400">0</span>
                </p>
                <p class="flex justify-between items-center text-sm">
                    <span class="pr-2">üåô –ù–æ—á–Ω—ã—Ö —Å–º–µ–Ω (1.5):</span>
                    <span id="nightShiftsCount" class="font-semibold flex-shrink-0 text-blue-600 dark:text-blue-400">0</span>
                </p>
            </div>
            
            <hr class="border-t border-gray-200 dark:border-gray-700 my-2">
            
            <!-- –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è —á–∞—Å–æ–≤ -->
            <div class="ml-2 space-y-1">
                <p class="flex justify-between items-center text-sm font-medium">
                    <span class="pr-2">‚è±Ô∏è –í—Å–µ–≥–æ —á–∞—Å–æ–≤ (1.0x):</span>
                    <span id="totalPaidHours" class="font-semibold text-gray-700 dark:text-gray-300 flex-shrink-0">0</span>
                </p>
                <p class="flex justify-between items-center text-sm font-medium">
                    <span class="pr-2">üåÉ –ß–∞—Å—ã –Ω–∞–¥–±–∞–≤–∫–∏ (0.5x):</span>
                    <span id="totalNightHours1_5" class="font-semibold text-gray-700 dark:text-gray-300 flex-shrink-0">0</span>
                </p>
            </div>
        </div>
        
        <!-- –ß–∞—Å—Ç—å –í: –î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (–ë–†–£–¢–¢–û) -->
        <h3 class="font-semibold text-gray-700 dark:text-gray-300 mb-3 border-b dark:border-gray-700 pb-1">–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (–ë–†–£–¢–¢–û):</h3>
        <table class="w-full text-sm calc-table mb-6">
            <tbody class="text-gray-700 dark:text-gray-300">
                <tr>
                    <td class="p-1 pl-3">–ë–∞–∑–æ–≤—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ (–í—Å–µ —á–∞—Å—ã, 1.0x):</td>
                    <td id="earningBase" class="p-1">0 —Ç–≥</td>
                </tr>
                <tr>
                    <td class="p-1 pl-3">–ù–æ—á–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞ (0.5x):</td>
                    <td id="earningNightPremium" class="p-1">0 —Ç–≥</td>
                </tr>
            </tbody>
        </table>
        
        <!-- –ß–∞—Å—Ç—å –°: –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç - –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –±–ª–æ–∫ (–ê–î–ê–ü–¢–ò–í–ù–´–ô –ö–†–ê–°–ù–´–ô) -->
        <div class="p-4 bg-red-50 dark:bg-red-900/40 border-2 border-red-300 dark:border-red-700 rounded-xl flex flex-col justify-start transition-colors duration-300">
            <!-- –ù–∞–¥–ø–∏—Å—å -->
            <span class="text-md text-gray-800 dark:text-gray-200 font-medium mb-1 self-start">–ò—Ç–æ–≥–æ –ë—Ä—É—Ç—Ç–æ</span>
            
            <!-- –°—É–º–º–∞: –∫—Ä—É–ø–Ω–∞—è, –∫—Ä–∞—Å–Ω–∞—è (–∞–¥–∞–ø—Ç–∏–≤–Ω–∞—è), –∂–∏—Ä–Ω–∞—è -->
            <span id="hourlyGrossSalaryResult" class="text-3xl text-red-700 dark:text-red-400 font-extrabold self-end transition-colors duration-300">0 —Ç–≥</span>
        </div>
    </div>
    
    <!-- 4. –ü–æ–¥—Ä–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ -->
    <div class="card mb-8 bg-tg_card_light dark:bg-tg_card_dark transition-colors duration-300 shadow-md dark:shadow-none dark:border dark:border-gray-700">
        <h3 class="text-xl font-bold mb-5 text-gray-800 dark:text-gray-200 border-b dark:border-gray-700 pb-2">4. –ü–æ–¥—Ä–æ–±–Ω—ã–π –≥—Ä–∞—Ñ–∏–∫ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞</h3>
        <p class="text-xs text-gray-500 dark:text-gray-400 mb-4">–í—ã–±–µ—Ä–∏—Ç–µ –º–µ—Å—è—Ü –≤ –†–∞–∑–¥–µ–ª–µ 2. –°–º–µ–Ω—ã –º–æ–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é.</p>
        <div class="max-h-60 overflow-y-auto border border-gray-200 dark:border-gray-600 rounded-xl shadow-inner dark:shadow-none">
            <table class="w-full text-sm">
                <thead>
                    <tr class="sticky top-0 bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 font-semibold shadow-sm transition-colors duration-300">
                        <!-- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è –¥–∞—Ç—ã -->
                        <th class="p-3 text-left schedule-table-date">–î–∞—Ç–∞</th>
                        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è —à–∏—Ä–∏–Ω–∞ –¥–ª—è —Å–º–µ–Ω—ã -->
                        <th class="p-3 text-left schedule-table-shift">–°–º–µ–Ω–∞</th>
                    </tr>
                </thead>
                <tbody id="scheduleTableBody" class="text-gray-700 dark:text-gray-300">
                    <!-- –ó–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è JavaScript -->
                </tbody>
            </table>
        </div>
    </div>

</div>

<script>
    // --- –ì–õ–û–ë–ê–õ–¨–ù–û–ï –°–û–°–¢–û–Ø–ù–ò–ï –ò –ö–û–ù–°–¢–ê–ù–¢–´ (–õ–û–ì–ò–ö–ê –ù–ï –ò–ó–ú–ï–ù–ï–ù–ê) ---
    const SHIFT_CYCLE = [
        { name: "–î–Ω–µ–≤–Ω–∞—è (–î)", index: 0, colorClass: 'text-shift-0' },
        { name: "–ù–æ—á–Ω–∞—è (–ù)", index: 1, colorClass: 'text-shift-1' },
        { name: "–û—Ç—Å—ã–ø–Ω–æ–π (–û)", index: 2, colorClass: 'text-shift-2' },
        { name: "–í—ã—Ö–æ–¥–Ω–æ–π (–í)", index: 3, colorClass: 'text-shift-3' },
    ];
    
    const SHIFT_SCHEMES = {
        '5/2_D': {
            name: "5/2 (–î,–î,–î,–î,–î,–í,–í)",
            pattern: [0, 0, 0, 0, 0, 3, 3], 
            cycleLength: 7,
            defaultHours: 8,
        },
        '2/2_DNOW': {
            name: "2/2 (–î,–ù,–û,–í) - 11—á",
            pattern: [0, 1, 2, 3], 
            cycleLength: 4,
            defaultHours: 11,
        },
        '2/2_DDVV': {
            name: "2/2 (–î,–î,–í,–í) - 11—á",
            pattern: [0, 0, 3, 3], 
            cycleLength: 4,
            defaultHours: 11,
        },
    };
    const DEFAULT_SCHEME_KEY = '2/2_DNOW';
    
    const ALL_SHIFT_OPTIONS = [
        { value: -1, name: "–ü–æ –≥—Ä–∞—Ñ–∏–∫—É" },
        { value: 0, name: "–î–Ω–µ–≤–Ω–∞—è (–î)" },
        { value: 1, name: "–ù–æ—á–Ω–∞—è (–ù)" },
        { value: 2, name: "–û—Ç—Å—ã–ø–Ω–æ–π (–û)" },
        { value: 3, name: "–í—ã—Ö–æ–¥–Ω–æ–π (–í)" },
    ];
    
    // –•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ä—É—á–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å–º–µ–Ω
    let modifiedShifts = {};

    const NIGHT_RATE_MULTIPLIER = 1.5;

    // –ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    let currentCalendarDate = new Date();
    const MONTH_NAMES = ["–Ø–Ω–≤–∞—Ä—å", "–§–µ–≤—Ä–∞–ª—å", "–ú–∞—Ä—Ç", "–ê–ø—Ä–µ–ª—å", "–ú–∞–π", "–ò—é–Ω—å", "–ò—é–ª—å", "–ê–≤–≥—É—Å—Ç", "–°–µ–Ω—Ç—è–±—Ä—å", "–û–∫—Ç—è–±—Ä—å", "–ù–æ—è–±—Ä—å", "–î–µ–∫–∞–±—Ä—å"];

    // --- –£—Ç–∏–ª–∏—Ç—ã ---

    /**
     * –§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —á–∏—Å–ª–æ –∫–∞–∫ –¥–µ–Ω–µ–∂–Ω—É—é —Å—É–º–º—É —Å –ø—Ä–æ–±–µ–ª–∞–º–∏ –∏ –æ–∫—Ä—É–≥–ª—è–µ—Ç –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π.
     */
    function formatCurrency(amount) {
        // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ –¥–≤—É—Ö –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π, –∑–∞—Ç–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º
        const roundedAmount = Math.round(amount * 100) / 100;
        return roundedAmount.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }
    
    /**
     * –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞—Ç—É YYYY-MM-DD –≤ DD.MM.YYYY.
     */
    function formatDateDisplay(dateStr) {
        const [year, month, day] = dateStr.split('-');
        return `${day}.${month}.${year}`;
    }

    /**
     * –ü–æ–ª—É—á–∞–µ—Ç —Ç–µ–∫—É—â—É—é –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
     */
    function getTodayDateString() {
        const today = new Date();
        const year = today.getFullYear();
        const month = String(today.getMonth() + 1).padStart(2, '0');
        const day = String(today.getDate()).padStart(2, '0');
        return `${year}-${month}-${day}`;
    }

    /**
     * –û—á–∏—â–∞–µ—Ç —Ä—É—á–Ω—ã–µ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–º–µ–Ω.
     */
    function clearOverrides() {
        modifiedShifts = {};
    }

    // --- –õ–æ–≥–∏–∫–∞ –ö–∞–ª–µ–Ω–¥–∞—Ä—è –∏ –°–º–µ–Ω ---

    function getShiftIndexForDate(date) {
        const schemeKey = document.getElementById('shiftSchemeSelector').value;
        const scheme = SHIFT_SCHEMES[schemeKey] || SHIFT_SCHEMES[DEFAULT_SCHEME_KEY];

        if (schemeKey === '5/2_D') {
            const dayOfWeek = (date.getDay() + 6) % 7; 
            return scheme.pattern[dayOfWeek];
        }

        const startDateStr = document.getElementById('startDateInput').value;
        if (!startDateStr) return 3; 

        const startDate = new Date(startDateStr + 'T12:00:00');
        const dateAtNoon = new Date(date.getFullYear(), date.getMonth(), date.getDate(), 12);
        
        const diffTime = dateAtNoon.getTime() - startDate.getTime();
        const diffDays = Math.round(diffTime / (1000 * 60 * 60 * 24));

        const indexInCycle = (diffDays % scheme.cycleLength + scheme.cycleLength) % scheme.cycleLength;
        
        return scheme.pattern[indexInCycle];
    }

    function renderCalendar() {
        const calendarHeader = document.getElementById('calendarMonthYear');
        const calendarBody = document.getElementById('calendarDays');
        
        const currentYear = currentCalendarDate.getFullYear();
        const currentMonth = currentCalendarDate.getMonth();
        
        calendarHeader.textContent = `${MONTH_NAMES[currentMonth]} ${currentYear}`;
        calendarBody.innerHTML = ''; 

        const firstDayOfMonth = new Date(currentYear, currentMonth, 1);
        const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
        
        let startDayIndex = (firstDayOfMonth.getDay() + 6) % 7; 
        
        const selectedDateStr = document.getElementById('startDateInput').value;
        
        for (let i = 0; i < startDayIndex; i++) {
            calendarBody.innerHTML += '<div class="calendar-day day-empty"></div>';
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const date = new Date(currentYear, currentMonth, day);

            const monthPadded = String(currentMonth + 1).padStart(2, '0');
            const dayPadded = String(day).padStart(2, '0');
            const dateStr = `${currentYear}-${monthPadded}-${dayPadded}`;
            
            const plannedShiftIndex = getShiftIndexForDate(date);
            
            const finalShiftIndex = modifiedShifts[dateStr] !== undefined && modifiedShifts[dateStr] !== -1
                ? modifiedShifts[dateStr]
                : plannedShiftIndex;

            const shiftType = SHIFT_CYCLE.find(s => s.index === finalShiftIndex);
            const shiftClass = `shift-${shiftType.index}`;
            const isSelected = dateStr === selectedDateStr ? 'day-selected' : '';

            const shiftLabel = shiftType.name.substring(shiftType.name.indexOf('(') + 1, shiftType.name.indexOf(')'));
            
            calendarBody.innerHTML += `
                <div 
                    class="calendar-day ${shiftClass} ${isSelected}" 
                    onclick="selectDate('${dateStr}')"
                >
                    ${day}
                    <div class="day-label">${shiftLabel}</div>
                </div>
            `;
        }
    }

    function toggleCalendar() {
        const container = document.getElementById('calendarContainer');
        const isHidden = container.classList.contains('hidden');
        
        if (isHidden) {
            const selectedDateStr = document.getElementById('startDateInput').value;
            if (selectedDateStr) {
                const [year, month, day] = selectedDateStr.split('-');
                currentCalendarDate = new Date(year, month - 1, day);
            } else {
                currentCalendarDate = new Date();
            }
            renderCalendar();
        }

        container.classList.toggle('hidden');
    }

    function changeMonth(delta) {
        currentCalendarDate.setMonth(currentCalendarDate.getMonth() + delta);
        renderCalendar();
    }

    function selectDate(dateStr) {
        const display = document.getElementById('startDateDisplay');
        const input = document.getElementById('startDateInput');
        
        input.value = dateStr;
        display.textContent = formatDateDisplay(dateStr);
        
        document.getElementById('calendarContainer').classList.add('hidden');
        
        clearOverrides();
        updateCalculations();
    }

    function handleShiftOverride(dateKey, newShiftIndex) {
        if (newShiftIndex === -1) {
            delete modifiedShifts[dateKey]; 
        } else {
            modifiedShifts[dateKey] = newShiftIndex; 
        }
        updateCalculations();
    }
    
    function applySchemeDefaults() {
        const schemeKey = document.getElementById('shiftSchemeSelector').value;
        const scheme = SHIFT_SCHEMES[schemeKey] || SHIFT_SCHEMES[DEFAULT_SCHEME_KEY];
        document.getElementById('hoursPerShiftInput').value = scheme.defaultHours;
        updateCalculations();
    }

    function updateHoursAndRecalculate() {
        let hours = parseFloat(document.getElementById('hoursPerShiftInput').value);
        if (isNaN(hours) || hours <= 0) {
            document.getElementById('hoursPerShiftInput').value = 1;
        }
        updateCalculations();
    }

    // --- –û–°–ù–û–í–ù–ê–Ø –õ–û–ì–ò–ö–ê –†–ê–°–ß–ï–¢–ê ---

    function calculateShiftCosts(rate) {
        const rateFloat = parseFloat(rate) || 0;
        
        const nightRate = rateFloat * NIGHT_RATE_MULTIPLIER; // 1.5x

        // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Å—Ç–∞–≤–æ–∫
        const isDarkMode = document.documentElement.classList.contains('dark');
        const rateTextColor = isDarkMode ? 'text-gray-100' : 'text-gray-900';
        const dayShiftColor = isDarkMode ? 'text-green-400' : 'text-green-600';
        const nightShiftColor = isDarkMode ? 'text-blue-400' : 'text-blue-600';

        document.getElementById('dayShiftCost').innerHTML = 
            `<span class="${dayShiftColor} font-semibold">‚òÄÔ∏è –°—Ç–∞–≤–∫–∞ –î–ï–ù–¨ (1.0x):</span> 
            <span class="font-bold ${rateTextColor} ml-1 flex-shrink-0">${formatCurrency(rateFloat)} —Ç–≥/—á–∞—Å</span>`;
        document.getElementById('nightShiftCost').innerHTML = 
            `<span class="${nightShiftColor} font-semibold">üåô –°—Ç–∞–≤–∫–∞ –ù–û–ß–¨ (1.5x):</span> 
            <span class="font-bold ${rateTextColor} ml-1 flex-shrink-0">${formatCurrency(nightRate)} —Ç–≥/—á–∞—Å</span>`;
            
        const hoursPerShift = parseFloat(document.getElementById('hoursPerShiftInput').value) || 0; 
        return { hoursPerShift };
    }

    function calculateShiftsAndTaxes() {
        const rateInput = document.getElementById('hourlyRateInput');
        const startDateInput = document.getElementById('startDateInput');
        
        const rate = rateInput.value;
        const startDateStr = startDateInput.value;
        const rateFloat = parseFloat(rate) || 0;

        const { hoursPerShift } = calculateShiftCosts(rate);

        if (!startDateStr || rateFloat <= 0 || hoursPerShift <= 0) {
            // –°–±—Ä–æ—Å, –µ—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –Ω–µ–≤–∞–ª–∏–¥–Ω—ã
            const emptyState = "0";
            document.getElementById('totalShifts').textContent = emptyState;
            document.getElementById('hourlyGrossSalaryResult').textContent = "0 —Ç–≥";
            document.getElementById('scheduleTableBody').innerHTML = '';
            document.getElementById('currentMonthName').textContent = '–ú–µ—Å—è—Ü';
            
            // –°–±—Ä–æ—Å –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Ä–∞—Å—á–µ—Ç–∞
            const elementsToReset = ['totalPaidHours', 'totalNightHours1_5', 'earningBase', 'earningNightPremium', 'dayShiftsCount', 'nightShiftsCount'];
            elementsToReset.forEach(id => {
                 const el = document.getElementById(id);
                 // –ò—Å–ø–æ–ª—å–∑—É–µ–º "0" –¥–ª—è —Å—á–µ—Ç—á–∏–∫–æ–≤ –∏ "0.00 —Ç–≥" –¥–ª—è —Å—É–º–º
                 const value = (id.includes('Hours') || id.includes('Shifts')) ? "0" : '0.00 —Ç–≥';
                 if (el) el.textContent = value;
            });
            return;
        }

        const calcDate = new Date(startDateStr + 'T12:00:00'); 
        const year = calcDate.getFullYear();
        const month = calcDate.getMonth(); 
        
        const monthName = calcDate.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });
        document.getElementById('currentMonthName').textContent = monthName.charAt(0).toUpperCase() + monthName.slice(1);

        let dayShiftsCount = 0;
        let nightShiftsCount = 0;
        let totalPaidHours = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ (–±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞ 1.0x)
        let totalNightHoursPremium = 0; // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —á–∞—Å–æ–≤ –¥–ª—è –Ω–∞–¥–±–∞–≤–∫–∏ (0.5x)
        let tableHTML = '';
        
        // 1. –†–ê–°–ß–ï–¢ –ü–û –°–ú–ï–ù–ê–ú –ò –ì–†–ê–§–ò–ö–£
        const firstDayOfMonth = new Date(year, month, 1);
        const lastDayOfMonth = new Date(year, month + 1, 0);

        for (let date = new Date(firstDayOfMonth); date <= lastDayOfMonth; date.setDate(date.getDate() + 1)) {
            const dateKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            const plannedShiftIndex = getShiftIndexForDate(date);
            const finalShiftIndex = (modifiedShifts[dateKey] !== undefined && modifiedShifts[dateKey] !== -1)
                ? modifiedShifts[dateKey]
                : plannedShiftIndex;

            const finalShift = SHIFT_CYCLE.find(s => s.index === finalShiftIndex);
            
            if (finalShift.index === 0) { // –î–Ω–µ–≤–Ω–∞—è
                dayShiftsCount++;
                totalPaidHours += hoursPerShift;
            } else if (finalShift.index === 1) { // –ù–æ—á–Ω–∞—è
                nightShiftsCount++;
                totalPaidHours += hoursPerShift;
                // –ù–æ—á–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∑–∞ 8 —á–∞—Å–æ–≤ (–∏–ª–∏ –º–µ–Ω—å—à–µ, –µ—Å–ª–∏ —Å–º–µ–Ω–∞ –∫–æ—Ä–æ—á–µ)
                totalNightHoursPremium += Math.min(hoursPerShift, 8); 
            }

            const dateStrFormatted = date.toLocaleDateString('ru-RU', { day: '2-digit', month: '2-digit' });
            
            // –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è —Å—Ç—Ä–æ–∫ —Ç–∞–±–ª–∏—Ü—ã
            const isModified = modifiedShifts[dateKey] !== undefined && modifiedShifts[dateKey] !== -1;
            let highlightClass;
            if (isModified) {
                highlightClass = 'bg-indigo-100 dark:bg-blue-900/40 font-semibold';
            } else {
                highlightClass = 'odd:bg-white even:bg-gray-50 dark:odd:bg-tg_card_dark dark:even:bg-gray-800/50';
            }

            const selectOptionsHTML = ALL_SHIFT_OPTIONS.map(opt => {
                const isDefault = opt.value === -1;
                const isSelected = (isDefault && !isModified) || (opt.value === modifiedShifts[dateKey]);
                // –£–¥–∞–ª—è–µ–º –ª–∏—à–Ω–∏–µ —Å–∫–æ–±–∫–∏ –≤ "–ü–æ –≥—Ä–∞—Ñ–∏–∫—É" –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞
                const shiftNameText = SHIFT_CYCLE[plannedShiftIndex].name.replace(/\s+\(([^)]+)\)$/, ' ($1)');
                const finalLabel = isDefault ? `–ü–æ –≥—Ä–∞—Ñ–∏–∫—É ${shiftNameText}` : opt.name;
                
                return `<option value="${opt.value}" ${isSelected ? 'selected' : ''}>${finalLabel}</option>`;
            }).join('');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã –¥–ª—è –∏–Ω–ø—É—Ç–∞ –≤—ã–±–æ—Ä–∞ —Å–º–µ–Ω—ã
            const selectBgClass = isDarkMode() ? 'bg-gray-700 text-gray-200' : 'bg-white text-gray-700';

            const shiftDisplayHTML = `
                <select 
                    class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg text-sm ${finalShift.colorClass} ${selectBgClass} focus:ring-tg_accent dark:focus:ring-tg_dark_accent"
                    onchange="handleShiftOverride('${dateKey}', parseInt(this.value))"
                >
                    ${selectOptionsHTML}
                </select>`;

            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —à–∏—Ä–∏–Ω—ã –¥–∞—Ç—ã –∏ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —à–∏—Ä–∏–Ω—ã —Å–º–µ–Ω—ã
            tableHTML += `<tr class="${highlightClass} border-b dark:border-gray-700">
                <td class="p-2 font-medium schedule-table-date">${dateStrFormatted}</td>
                <td class="p-1 schedule-table-shift">${shiftDisplayHTML}</td>
            </tr>`;
        }
        
        // --- –†–ê–°–ß–ï–¢ –ë–†–£–¢–¢–û-–ó–ü ---
        
        // 1. –ë–∞–∑–æ–≤—ã–π –∑–∞—Ä–∞–±–æ—Ç–æ–∫ (–í—Å–µ —á–∞—Å—ã * 1.0x)
        const earningBase = totalPaidHours * rateFloat; 

        // 2. –ù–æ—á–Ω–∞—è –Ω–∞–¥–±–∞–≤–∫–∞ (–ß–∞—Å—ã –¥–ª—è –Ω–∞–¥–±–∞–≤–∫–∏ * 0.5x)
        const earningNightPremium = totalNightHoursPremium * (rateFloat * 0.5);

        // –ò—Ç–æ–≥–æ–≤–∞—è –ë–†–£–¢–¢–û-–ó–ü
        const hourlyGrossSalary = earningBase + earningNightPremium;

        // --- –û–ë–ù–û–í–õ–ï–ù–ò–ï UI (–°–≤–æ–¥–Ω—ã–π –æ—Ç—á–µ—Ç) ---
        document.getElementById('totalShifts').textContent = dayShiftsCount + nightShiftsCount;
        document.getElementById('dayShiftsCount').textContent = dayShiftsCount;
        document.getElementById('nightShiftsCount').textContent = nightShiftsCount;
        document.getElementById('totalPaidHours').textContent = formatCurrency(totalPaidHours);
        document.getElementById('totalNightHours1_5').textContent = formatCurrency(totalNightHoursPremium);
        document.getElementById('hourlyGrossSalaryResult').textContent = formatCurrency(hourlyGrossSalary) + " —Ç–≥";
        document.getElementById('scheduleTableBody').innerHTML = tableHTML;
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞—á–∏—Å–ª–µ–Ω–∏–π (–≤ –æ–±—ä–µ–¥–∏–Ω–µ–Ω–Ω–æ–º –±–ª–æ–∫–µ 3)
        document.getElementById('earningBase').textContent = formatCurrency(earningBase) + " —Ç–≥";
        document.getElementById('earningNightPremium').textContent = formatCurrency(earningNightPremium) + " —Ç–≥";
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
        if (!document.getElementById('calendarContainer').classList.contains('hidden')) {
            renderCalendar();
        }
    }
    
    function isDarkMode() {
        return document.documentElement.classList.contains('dark');
    }

    function updateCalculations() {
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤–∫–ª—é—á–µ–Ω –ª–∏ —Ç–µ–º–Ω—ã–π —Ä–µ–∂–∏–º (–¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã calculateShiftCosts)
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }

        calculateShiftsAndTaxes();
    }
    
    // –î–æ–±–∞–≤–ª—è–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ç–µ–º—ã
    if (window.matchMedia) {
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
            // –ü–µ—Ä–µ—Å—á–µ—Ç, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ –≤ JS (–≤ calculateShiftCosts)
            updateCalculations();
        });
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    window.onload = () => {
        const todayStr = getTodayDateString();
        document.getElementById('startDateInput').value = todayStr;
        document.getElementById('startDateDisplay').textContent = formatDateDisplay(todayStr);
        
        const [year, month, day] = todayStr.split('-');
        currentCalendarDate = new Date(year, month - 1, day);

        applySchemeDefaults();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–≥–æ –ø–µ—Ä–µ—Å—á–µ—Ç–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–º—ã
        updateCalculations();
    };
</script>
</body>
</html>
